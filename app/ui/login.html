<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Blog Agent ‚Ä¢ Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="login-box">
  <h2>üîê Login</h2>

  <input
    id="username"
    placeholder="Username"
    maxlength="50"
    autocomplete="username"
  />

  <input
    id="password"
    type="password"
    placeholder="Password"
    maxlength="50"
    autocomplete="current-password"
  />

  <button id="loginBtn">Login</button>

  <p id="error" class="error"></p>
</div>

<script>
const btn = document.getElementById("loginBtn");
const error = document.getElementById("error");

btn.onclick = login;
document.addEventListener("keydown", e => {
  if (e.key === "Enter") login();
});

// Dark mode support
if (localStorage.getItem("dark") === "1") {
  document.body.classList.add("dark");
}

async function login() {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();

  error.textContent = "";

  if (!username || !password) {
    error.textContent = "Both fields are required";
    return;
  }

  if (username.length > 50 || password.length > 50) {
    error.textContent = "Input too long";
    return;
  }

  btn.disabled = true;
  btn.textContent = "Logging in‚Ä¶";

  try {
    const res = await fetch("/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });

    if (!res.ok) {
      throw new Error("Invalid credentials");
    }

    const data = await res.json();
    localStorage.setItem("token", data.access_token);
    location.href = "/ui/";
  } catch {
    error.textContent = "Invalid username or password";
  } finally {
    btn.disabled = false;
    btn.textContent = "Login";
  }
}
</script>

</body>
</html>
