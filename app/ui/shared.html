<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shared Blog â€¢ Read-only</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="shared-badge">ðŸ”’ Read-only</div>
<div id="sharedContent" class="editor-container">
  <p class="muted">Loading shared contentâ€¦</p>
</div>

<script>
async function loadShared() {
  const token = new URLSearchParams(location.search).get("token");

  if (!token || token.length > 500) {
    showError("Invalid or malformed link");
    return;
  }

  try {
    const res = await fetch(`/api/v1/shared?token=${encodeURIComponent(token)}`);

    if (!res.ok) throw new Error();

    const data = await res.json();

    const container = document.getElementById("sharedContent");
    container.innerHTML = "";

    const title = document.createElement("h1");
    title.textContent = data.title;
    container.appendChild(title);

    data.content.forEach(p => {
      const para = document.createElement("p");
      para.textContent = p; // SAFE
      container.appendChild(para);
    });
  } catch {
    showError("This shared link is expired or invalid");
  }
}

function showError(msg) {
  document.getElementById("sharedContent").innerHTML =
    `<p class="error">${msg}</p>`;
}

// Dark mode support
if (localStorage.getItem("dark") === "1") {
  document.body.classList.add("dark");
}

loadShared();
</script>

</body>
</html>
